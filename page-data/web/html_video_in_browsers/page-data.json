{"componentChunkName":"component---src-templates-blog-post-js","path":"/web/html_video_in_browsers/","result":{"data":{"site":{"siteMetadata":{"title":"Blog-Around"}},"markdownRemark":{"id":"bef1877d-7d98-5d7b-b4f2-ecb6a96df5d0","excerpt":"HtmlVideoElement…","html":"<h1>HtmlVideoElement 정책 정리.</h1>\n<p>동영상은 브라우저별, 기기별 종속성이 큰 요소 타입이다. 본 필자는 회사에서 프로젝트를 진행하면서 각 기기 별로, 브라우저별로 다른 인터페이스 제공, 정책 때문에 애를 먹었다.\n때문에 추후 동영상을 다룰때 필요한 정보를 쉽게 찾기 위해 정리해본다.</p>\n<h2>브라우저별 지원하는 MP4 컨테이너 코덱</h2>\n<ul>\n<li>필자는 이번 프로젝트에서 지원범위를 mp4 미디어 컨테이너로만 잡았다 때문에 mp4에 대해서만 조사를 진행했다. 한 컨테이너 내에서도 여러 코덱이 있고, 각각의 코덱은 브라우저별로 지원여부가 다르기때문에 서비스의 정책을 정할때에도 이를 정리할 필요가 있어보인다.</li>\n</ul>\n<h3>MP4 (MPEG4)</h3>\n<ul>\n<li>가장 먼저 알아야 할 내용은 MP4는 영상 + 오디오 컨테이너이고 내부에 들어갈 수 있는 내용물인 사운드, 비디오는 같은 컨테이너 종류 내에서도 각각 다른 형식의 코덱을 가지고 있을 수 있다.  mp4 내에서 사용하는 비디오 코덱은 아래와 같은 것들이 있는데, 각각의 브라우저별 지원여부는 아래와 같다. </li>\n</ul>\n<h3>비디오 코덱</h3>\n<table>\n<thead>\n<tr>\n<th align=\"center\">codec</th>\n<th align=\"center\">chrome</th>\n<th align=\"center\">firefox</th>\n<th align=\"center\">safari</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"center\">AVC (H.264)</td>\n<td align=\"center\">Yes</td>\n<td align=\"center\">Yes</td>\n<td align=\"center\">Yes</td>\n</tr>\n<tr>\n<td align=\"center\">AV1</td>\n<td align=\"center\">Yes(Only Chrome OS, Linux, macOS, and Windows at present)</td>\n<td align=\"center\">Yes</td>\n<td align=\"center\">No</td>\n</tr>\n<tr>\n<td align=\"center\">H.263</td>\n<td align=\"center\">?</td>\n<td align=\"center\">No</td>\n<td align=\"center\">?</td>\n</tr>\n<tr>\n<td align=\"center\">H.265</td>\n<td align=\"center\">No</td>\n<td align=\"center\">No</td>\n<td align=\"center\">Yes</td>\n</tr>\n<tr>\n<td align=\"center\">MPEG-4 Part 2 Visual</td>\n<td align=\"center\">No</td>\n<td align=\"center\">No</td>\n<td align=\"center\">Yes</td>\n</tr>\n<tr>\n<td align=\"center\">VP9</td>\n<td align=\"center\">Yes</td>\n<td align=\"center\">Yes</td>\n<td align=\"center\">No</td>\n</tr>\n</tbody>\n</table>\n<h3>오디오 코덱</h3>\n<table>\n<thead>\n<tr>\n<th align=\"center\">codec</th>\n<th align=\"center\">chrome</th>\n<th align=\"center\">firefox</th>\n<th align=\"center\">safari</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"center\">MP3</td>\n<td align=\"center\">yes</td>\n<td align=\"center\">Yes</td>\n<td align=\"center\">Yes</td>\n</tr>\n<tr>\n<td align=\"center\">ACC</td>\n<td align=\"center\">yes</td>\n<td align=\"center\">Yes</td>\n<td align=\"center\">Yes</td>\n</tr>\n<tr>\n<td align=\"center\">AC3</td>\n<td align=\"center\">No</td>\n<td align=\"center\">No</td>\n<td align=\"center\">No</td>\n</tr>\n</tbody>\n</table>\n<h4>관련 문서:</h4>\n<ul>\n<li><a href=\"https://videojs.com/html5-video-support/\">https://videojs.com/html5-video-support/</a></li>\n<li><a href=\"https://www.chromium.org/audio-video\">https://www.chromium.org/audio-video</a></li>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/Media/Formats/Containers#mp4\">https://developer.mozilla.org/en-US/docs/Web/Media/Formats/Containers#mp4</a></li>\n</ul>\n<h2>자동재생</h2>\n<p>프로젝트를 진행하며 자동재생을 해달라는 요구사항이 있었다. 처음 내가 해본 시도는 autoplay를 true로 set 하거나 video.play(); 를 호출해 비디오를 실행시키려고했다. 그러나 아래와 같은 에러메시지가 뜨면서 재생이 되지않는 경우가 있었고 이때문에 브라우저 자동재생 정책을 리서치하게 되었다. </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/Blog-Around/static/1fac5ff55ec2fa4f69f0d3a71f9de432/e405b/autoplay.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 6.329113924050632%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAU0lEQVQI12OINtX/7yLK/99FQui/s7jgf3d5yf+eStL/XeQl/jvJiv+3FuL5byfC999CgOu/OT8nGFsIcIL5Rrzs/82B+mxkJf5bSYv9N+Dj+A8AdbQb+AkDjzYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"autoPlay restriction\"\n        title=\"autoPlay restriction\"\n        src=\"/Blog-Around/static/1fac5ff55ec2fa4f69f0d3a71f9de432/f058b/autoplay.png\"\n        srcset=\"/Blog-Around/static/1fac5ff55ec2fa4f69f0d3a71f9de432/c26ae/autoplay.png 158w,\n/Blog-Around/static/1fac5ff55ec2fa4f69f0d3a71f9de432/6bdcf/autoplay.png 315w,\n/Blog-Around/static/1fac5ff55ec2fa4f69f0d3a71f9de432/f058b/autoplay.png 630w,\n/Blog-Around/static/1fac5ff55ec2fa4f69f0d3a71f9de432/40601/autoplay.png 945w,\n/Blog-Around/static/1fac5ff55ec2fa4f69f0d3a71f9de432/78612/autoplay.png 1260w,\n/Blog-Around/static/1fac5ff55ec2fa4f69f0d3a71f9de432/e405b/autoplay.png 1566w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h3>자동재생 제약사항</h3>\n<ul>\n<li>동영상의 자동재생은 다음과 같은 제약사항들이 있다.</li>\n<li>음소거가 되어있으면 자동재생(autoplay&#x26;&#x26;play)은 항상 가능하다.</li>\n<li>\n<p>음소거가 되어있지 않은 상태에서 자동재생을 하기 위해서는 아래와 같은 조건일때만 가능하다.</p>\n<ul>\n<li>사용자와 도메인의 인터랙션이 한번이라도 있을 때 </li>\n<li>데스크탑에서 해당 비디오를 이전에 재생한 적이 있을 때</li>\n<li>사용자가 사이트를 모바일 홈스크린이나 PWA를 설치했을때</li>\n</ul>\n</li>\n</ul>\n<h3>관련 문서:</h3>\n<ul>\n<li><a href=\"https://developers.google.com/web/updates/2017/09/autoplay-policy-changes\">https://developers.google.com/web/updates/2017/09/autoplay-policy-changes</a></li>\n<li><a href=\"https://webkit.org/blog/6784/new-video-policies-for-ios/\">https://webkit.org/blog/6784/new-video-policies-for-ios/</a></li>\n</ul>\n<h2>동시 재생</h2>\n<ul>\n<li>대부분의 브라우저, OS는 동시재생을 지원한다. 하지만 애플의 IOS, IpadOS는 음량이 있는 경우 inline으로 여러 동영상의 동시재생을 지원하지 않는다. 제약사항은 브라우저별로, 기기별로 차이가 있는데 다음과 같다. </li>\n</ul>\n<h3>PC환경- 동시 재생 가능 여부</h3>\n<table>\n<thead>\n<tr>\n<th align=\"center\">상태</th>\n<th align=\"center\">chrome</th>\n<th align=\"center\">safari</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"center\">소리 재생</td>\n<td align=\"center\">yes</td>\n<td align=\"center\">yes</td>\n</tr>\n<tr>\n<td align=\"center\">음소거</td>\n<td align=\"center\">yes</td>\n<td align=\"center\">yes</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>yes: 동시재생 가능</li>\n<li>no: 동시재생 불가능</li>\n</ul>\n<h3>모바일 환경- 동시 재생 가능 여부 (기기 종속)</h3>\n<table>\n<thead>\n<tr>\n<th align=\"center\">상태</th>\n<th align=\"center\">chrome</th>\n<th align=\"center\">safari on ios</th>\n<th align=\"center\">chrome on ios</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"center\">소리 재생</td>\n<td align=\"center\">yes</td>\n<td align=\"center\">no</td>\n<td align=\"center\">no</td>\n</tr>\n<tr>\n<td align=\"center\">음소거</td>\n<td align=\"center\">yes</td>\n<td align=\"center\">yes</td>\n<td align=\"center\">yes</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>yes: 동시재생 가능</li>\n<li>no: 동시재생 불가능</li>\n</ul>\n<p>확인한바 모바일 IOS ,IpadOS에서는 음량이 있는 영상을 동시재생 할 수 없다.\n크롬의 경우 IOS에서 웹킷엔진을 이용하기 때문에 safari와 제약사항이 같다. </p>\n<h2>loadmetadata</h2>\n<ul>\n<li>loadmetadata event는 비디오가 재생되기 위해 video tag에 set된 src의 메타정보를 읽어왔을 때 발생하는 이벤트이다.</li>\n<li>ios의 경우 video 가 DOM에 보이는 상태로 로드 되지 않으면 onloadMetadata event 가 발생하지 않는다.(display:none 불가)</li>\n<li>\n<p>화면에 불러오기 전에 width, height를 먼저 set 해줘야 하는 경우가 많은데 width height 를 읽어올 수 없다.\n이런 경우 아래와 같은 처리가 필요하다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> videoTag<span class=\"token operator\">:</span>HTMLVideoElement<span class=\"token operator\">=</span>document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'video'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//비디오가 화면에서 안보이도록 처리</span>\nvideoTag<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> <span class=\"token string\">'0'</span><span class=\"token punctuation\">;</span>\nvideoTag<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> <span class=\"token string\">'0'</span><span class=\"token punctuation\">;</span>\nvideoTag<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>opacity <span class=\"token operator\">=</span> <span class=\"token string\">'0'</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//실제 돔에 붙여준다.</span>\ndocument<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>video<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nvideo<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'loadmetadata'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">{</span>\n<span class=\"token comment\">//do somthing</span>\ndocument<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">removeChild</span><span class=\"token punctuation\">(</span>video<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//body에서 요소를 때준다.</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n</li>\n</ul>","frontmatter":{"title":"브라우저별 HtmlVideoElement 지원 사항 및 제약 사항.","date":"April 10, 2021","description":"비디오 관련 프로젝트를 하면서 정리한 브라우저별 HTMLVideoElement 지원사항, 정책 정리."}}},"pageContext":{"slug":"/web/html_video_in_browsers/","previous":{"fields":{"slug":"/project/bingo_with_redux/"},"frontmatter":{"title":"Bingo with react and redux."}},"next":{"fields":{"slug":"/web/OAuth_20/"},"frontmatter":{"title":"OAuth 2.0"}}}},"staticQueryHashes":["2841359383","916993862"]}